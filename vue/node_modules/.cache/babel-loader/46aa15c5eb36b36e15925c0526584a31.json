{"ast":null,"code":"import { defineComponent, inject, ref, computed, watch, resolveComponent, openBlock, createElementBlock, normalizeClass, Fragment, renderList, normalizeStyle, createVNode, withCtx, createBlock, resolveDynamicComponent, createCommentVNode, toDisplayString } from 'vue';\nimport { isObject, isArray } from '@vue/shared';\nimport '../../../tokens/index.mjs';\nimport '../../../utils/index.mjs';\nimport '../../../constants/index.mjs';\nimport { ElIcon } from '../../icon/index.mjs';\nimport { StarFilled, Star } from '@element-plus/icons-vue';\nimport '../../../hooks/index.mjs';\nimport { rateProps, rateEmits } from './rate.mjs';\nimport _export_sfc from '../../../_virtual/plugin-vue_export-helper.mjs';\nimport { elFormKey } from '../../../tokens/form.mjs';\nimport { useSize } from '../../../hooks/use-common-props/index.mjs';\nimport { useNamespace } from '../../../hooks/use-namespace/index.mjs';\nimport { UPDATE_MODEL_EVENT } from '../../../constants/event.mjs';\nimport { EVENT_CODE } from '../../../constants/aria.mjs';\nimport { hasClass } from '../../../utils/dom/style.mjs';\n\nfunction getValueFromMap(value, map) {\n  const isExcludedObject = val => isObject(val);\n\n  const matchedKeys = Object.keys(map).map(key => +key).filter(key => {\n    const val = map[key];\n    const excluded = isExcludedObject(val) ? val.excluded : false;\n    return excluded ? value < key : value <= key;\n  }).sort((a, b) => a - b);\n  const matchedValue = map[matchedKeys[0]];\n  return isExcludedObject(matchedValue) && matchedValue.value || matchedValue;\n}\n\nconst _sfc_main = defineComponent({\n  name: \"ElRate\",\n  components: {\n    ElIcon,\n    StarFilled,\n    Star\n  },\n  props: rateProps,\n  emits: rateEmits,\n\n  setup(props, {\n    emit\n  }) {\n    const elForm = inject(elFormKey, {});\n    const rateSize = useSize();\n    const ns = useNamespace(\"rate\");\n    const currentValue = ref(props.modelValue);\n    const hoverIndex = ref(-1);\n    const pointerAtLeftHalf = ref(true);\n    const rateKls = computed(() => [ns.b(), ns.m(rateSize.value)]);\n    const rateDisabled = computed(() => props.disabled || elForm.disabled);\n    const text = computed(() => {\n      let result = \"\";\n\n      if (props.showScore) {\n        result = props.scoreTemplate.replace(/\\{\\s*value\\s*\\}/, rateDisabled.value ? `${props.modelValue}` : `${currentValue.value}`);\n      } else if (props.showText) {\n        result = props.texts[Math.ceil(currentValue.value) - 1];\n      }\n\n      return result;\n    });\n    const valueDecimal = computed(() => props.modelValue * 100 - Math.floor(props.modelValue) * 100);\n    const colorMap = computed(() => isArray(props.colors) ? {\n      [props.lowThreshold]: props.colors[0],\n      [props.highThreshold]: {\n        value: props.colors[1],\n        excluded: true\n      },\n      [props.max]: props.colors[2]\n    } : props.colors);\n    const activeColor = computed(() => getValueFromMap(currentValue.value, colorMap.value));\n    const decimalStyle = computed(() => {\n      let width = \"\";\n\n      if (rateDisabled.value) {\n        width = `${valueDecimal.value}%`;\n      } else if (props.allowHalf) {\n        width = \"50%\";\n      }\n\n      return {\n        color: activeColor.value,\n        width\n      };\n    });\n    const componentMap = computed(() => isArray(props.icons) ? {\n      [props.lowThreshold]: props.icons[0],\n      [props.highThreshold]: {\n        value: props.icons[1],\n        excluded: true\n      },\n      [props.max]: props.icons[2]\n    } : props.icons);\n    const decimalIconComponent = computed(() => getValueFromMap(props.modelValue, componentMap.value));\n    const voidComponent = computed(() => rateDisabled.value ? props.disabledvoidIcon : props.voidIcon);\n    const activeComponent = computed(() => getValueFromMap(currentValue.value, componentMap.value));\n    const iconComponents = computed(() => {\n      const result = Array(props.max);\n      const threshold = currentValue.value;\n      result.fill(activeComponent.value, 0, threshold);\n      result.fill(voidComponent.value, threshold, props.max);\n      return result;\n    });\n\n    function showDecimalIcon(item) {\n      const showWhenDisabled = rateDisabled.value && valueDecimal.value > 0 && item - 1 < props.modelValue && item > props.modelValue;\n      const showWhenAllowHalf = props.allowHalf && pointerAtLeftHalf.value && item - 0.5 <= currentValue.value && item > currentValue.value;\n      return showWhenDisabled || showWhenAllowHalf;\n    }\n\n    function getIconStyle(item) {\n      const voidColor = rateDisabled.value ? props.disabledVoidColor : props.voidColor;\n      return {\n        color: item <= currentValue.value ? activeColor.value : voidColor\n      };\n    }\n\n    function selectValue(value) {\n      if (rateDisabled.value) {\n        return;\n      }\n\n      if (props.allowHalf && pointerAtLeftHalf.value) {\n        emit(UPDATE_MODEL_EVENT, currentValue.value);\n\n        if (props.modelValue !== currentValue.value) {\n          emit(\"change\", currentValue.value);\n        }\n      } else {\n        emit(UPDATE_MODEL_EVENT, value);\n\n        if (props.modelValue !== value) {\n          emit(\"change\", value);\n        }\n      }\n    }\n\n    function handleKey(e) {\n      if (rateDisabled.value) {\n        return;\n      }\n\n      let _currentValue = currentValue.value;\n      const code = e.code;\n\n      if (code === EVENT_CODE.up || code === EVENT_CODE.right) {\n        if (props.allowHalf) {\n          _currentValue += 0.5;\n        } else {\n          _currentValue += 1;\n        }\n\n        e.stopPropagation();\n        e.preventDefault();\n      } else if (code === EVENT_CODE.left || code === EVENT_CODE.down) {\n        if (props.allowHalf) {\n          _currentValue -= 0.5;\n        } else {\n          _currentValue -= 1;\n        }\n\n        e.stopPropagation();\n        e.preventDefault();\n      }\n\n      _currentValue = _currentValue < 0 ? 0 : _currentValue;\n      _currentValue = _currentValue > props.max ? props.max : _currentValue;\n      emit(UPDATE_MODEL_EVENT, _currentValue);\n      emit(\"change\", _currentValue);\n      return _currentValue;\n    }\n\n    function setCurrentValue(value, event) {\n      if (rateDisabled.value) {\n        return;\n      }\n\n      if (props.allowHalf) {\n        let target = event.target;\n\n        if (hasClass(target, ns.e(\"item\"))) {\n          target = target.querySelector(`.${ns.e(\"icon\")}`);\n        }\n\n        if (target.clientWidth === 0 || hasClass(target, ns.e(\"decimal\"))) {\n          target = target.parentNode;\n        }\n\n        pointerAtLeftHalf.value = event.offsetX * 2 <= target.clientWidth;\n        currentValue.value = pointerAtLeftHalf.value ? value - 0.5 : value;\n      } else {\n        currentValue.value = value;\n      }\n\n      hoverIndex.value = value;\n    }\n\n    function resetCurrentValue() {\n      if (rateDisabled.value) {\n        return;\n      }\n\n      if (props.allowHalf) {\n        pointerAtLeftHalf.value = props.modelValue !== Math.floor(props.modelValue);\n      }\n\n      currentValue.value = props.modelValue;\n      hoverIndex.value = -1;\n    }\n\n    watch(() => props.modelValue, val => {\n      currentValue.value = val;\n      pointerAtLeftHalf.value = props.modelValue !== Math.floor(props.modelValue);\n    });\n\n    if (!props.modelValue) {\n      emit(UPDATE_MODEL_EVENT, 0);\n    }\n\n    return {\n      ns,\n      hoverIndex,\n      currentValue,\n      rateDisabled,\n      text,\n      decimalStyle,\n      decimalIconComponent,\n      iconComponents,\n      rateKls,\n      showDecimalIcon,\n      getIconStyle,\n      selectValue,\n      handleKey,\n      setCurrentValue,\n      resetCurrentValue\n    };\n  }\n\n});\n\nconst _hoisted_1 = [\"aria-valuenow\", \"aria-valuetext\", \"aria-valuemax\"];\nconst _hoisted_2 = [\"onMousemove\", \"onClick\"];\n\nfunction _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_icon = resolveComponent(\"el-icon\");\n\n  return openBlock(), createElementBlock(\"div\", {\n    class: normalizeClass(_ctx.rateKls),\n    role: \"slider\",\n    \"aria-valuenow\": _ctx.currentValue,\n    \"aria-valuetext\": _ctx.text,\n    \"aria-valuemin\": \"0\",\n    \"aria-valuemax\": _ctx.max,\n    tabindex: \"0\",\n    onKeydown: _cache[1] || (_cache[1] = (...args) => _ctx.handleKey && _ctx.handleKey(...args))\n  }, [(openBlock(true), createElementBlock(Fragment, null, renderList(_ctx.max, (item, key) => {\n    return openBlock(), createElementBlock(\"span\", {\n      key,\n      class: normalizeClass(_ctx.ns.e(\"item\")),\n      style: normalizeStyle({\n        cursor: _ctx.rateDisabled ? \"auto\" : \"pointer\"\n      }),\n      onMousemove: $event => _ctx.setCurrentValue(item, $event),\n      onMouseleave: _cache[0] || (_cache[0] = (...args) => _ctx.resetCurrentValue && _ctx.resetCurrentValue(...args)),\n      onClick: $event => _ctx.selectValue(item)\n    }, [createVNode(_component_el_icon, {\n      class: normalizeClass([_ctx.ns.e(\"icon\"), {\n        hover: _ctx.hoverIndex === item\n      }]),\n      style: normalizeStyle(_ctx.getIconStyle(item))\n    }, {\n      default: withCtx(() => [!_ctx.showDecimalIcon(item) ? (openBlock(), createBlock(resolveDynamicComponent(_ctx.iconComponents[item - 1]), {\n        key: 0\n      })) : createCommentVNode(\"v-if\", true), _ctx.showDecimalIcon(item) ? (openBlock(), createBlock(_component_el_icon, {\n        key: 1,\n        style: normalizeStyle(_ctx.decimalStyle),\n        class: normalizeClass([_ctx.ns.e(\"icon\"), _ctx.ns.e(\"decimal\")])\n      }, {\n        default: withCtx(() => [(openBlock(), createBlock(resolveDynamicComponent(_ctx.decimalIconComponent)))]),\n        _: 1\n      }, 8, [\"style\", \"class\"])) : createCommentVNode(\"v-if\", true)]),\n      _: 2\n    }, 1032, [\"class\", \"style\"])], 46, _hoisted_2);\n  }), 128)), _ctx.showText || _ctx.showScore ? (openBlock(), createElementBlock(\"span\", {\n    key: 0,\n    class: normalizeClass(_ctx.ns.e(\"text\")),\n    style: normalizeStyle({\n      color: _ctx.textColor\n    })\n  }, toDisplayString(_ctx.text), 7)) : createCommentVNode(\"v-if\", true)], 42, _hoisted_1);\n}\n\nvar Rate = /* @__PURE__ */_export_sfc(_sfc_main, [[\"render\", _sfc_render]]);\n\nexport { Rate as default };","map":{"version":3,"mappings":"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","names":["value","map","isExcludedObject","val","isObject","matchedKeys","Object","keys","key","filter","excluded","sort","a","b","matchedValue","_sfc_main","defineComponent","name","components","ElIcon","StarFilled","Star","props","rateProps","emits","rateEmits","setup","emit","elForm","inject","elFormKey","rateSize","useSize","ns","useNamespace","currentValue","ref","modelValue","hoverIndex","pointerAtLeftHalf","rateKls","computed","m","rateDisabled","disabled","text","result","showScore","scoreTemplate","replace","showText","texts","Math","ceil","valueDecimal","floor","colorMap","isArray","colors","lowThreshold","highThreshold","max","activeColor","getValueFromMap","decimalStyle","width","allowHalf","color","componentMap","icons","decimalIconComponent","voidComponent","disabledvoidIcon","voidIcon","activeComponent","iconComponents","Array","threshold","fill","item","showWhenDisabled","showWhenAllowHalf","voidColor","disabledVoidColor","UPDATE_MODEL_EVENT","e","_currentValue","code","EVENT_CODE","up","right","stopPropagation","preventDefault","left","down","event","target","hasClass","querySelector","clientWidth","parentNode","offsetX","watch","showDecimalIcon","getIconStyle","selectValue","handleKey","setCurrentValue","resetCurrentValue","_createElementBlock","class","_normalizeClass","_ctx","role","tabindex","onKeydown","_cache","_Fragment","style","_normalizeStyle","onMousemove","$event","onMouseleave","onClick","_createVNode","_component_el_icon","hover","openBlock","_createBlock","_resolveDynamicComponent","createCommentVNode","_","toDisplayString"],"sources":["../../../../../../packages/components/rate/src/rate.vue"],"sourcesContent":["<template>\n  <div\n    :class=\"rateKls\"\n    role=\"slider\"\n    :aria-valuenow=\"currentValue\"\n    :aria-valuetext=\"text\"\n    aria-valuemin=\"0\"\n    :aria-valuemax=\"max\"\n    tabindex=\"0\"\n    @keydown=\"handleKey\"\n  >\n    <span\n      v-for=\"(item, key) in max\"\n      :key=\"key\"\n      :class=\"ns.e('item')\"\n      :style=\"{ cursor: rateDisabled ? 'auto' : 'pointer' }\"\n      @mousemove=\"setCurrentValue(item, $event)\"\n      @mouseleave=\"resetCurrentValue\"\n      @click=\"selectValue(item)\"\n    >\n      <el-icon\n        :class=\"[ns.e('icon'), { hover: hoverIndex === item }]\"\n        :style=\"getIconStyle(item)\"\n      >\n        <component\n          :is=\"iconComponents[item - 1]\"\n          v-if=\"!showDecimalIcon(item)\"\n        />\n        <el-icon\n          v-if=\"showDecimalIcon(item)\"\n          :style=\"decimalStyle\"\n          :class=\"[ns.e('icon'), ns.e('decimal')]\"\n        >\n          <component :is=\"decimalIconComponent\" />\n        </el-icon>\n      </el-icon>\n    </span>\n    <span\n      v-if=\"showText || showScore\"\n      :class=\"ns.e('text')\"\n      :style=\"{ color: textColor }\"\n    >\n      {{ text }}\n    </span>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, inject, computed, ref, watch } from 'vue'\nimport { isObject, isArray } from '@vue/shared'\nimport { elFormKey } from '@element-plus/tokens'\nimport { hasClass } from '@element-plus/utils'\nimport { EVENT_CODE, UPDATE_MODEL_EVENT } from '@element-plus/constants'\nimport { ElIcon } from '@element-plus/components/icon'\nimport { StarFilled, Star } from '@element-plus/icons-vue'\nimport { useNamespace, useSize } from '@element-plus/hooks'\nimport { rateProps, rateEmits } from './rate'\nimport type { ElFormContext } from '@element-plus/tokens'\n\nfunction getValueFromMap<T>(\n  value: number,\n  map: Record<string, T | { excluded?: boolean; value: T }>\n) {\n  const isExcludedObject = (\n    val: unknown\n  ): val is { excluded?: boolean } & Record<any, unknown> => isObject(val)\n\n  const matchedKeys = Object.keys(map)\n    .map((key) => +key)\n    .filter((key) => {\n      const val = map[key]\n      const excluded = isExcludedObject(val) ? val.excluded : false\n      return excluded ? value < key : value <= key\n    })\n    .sort((a, b) => a - b)\n  const matchedValue = map[matchedKeys[0]]\n  return (isExcludedObject(matchedValue) && matchedValue.value) || matchedValue\n}\n\nexport default defineComponent({\n  name: 'ElRate',\n  components: {\n    ElIcon,\n    StarFilled,\n    Star,\n  },\n  props: rateProps,\n  emits: rateEmits,\n\n  setup(props, { emit }) {\n    const elForm = inject(elFormKey, {} as ElFormContext)\n    const rateSize = useSize()\n    const ns = useNamespace('rate')\n\n    const currentValue = ref(props.modelValue)\n    const hoverIndex = ref(-1)\n    const pointerAtLeftHalf = ref(true)\n\n    const rateKls = computed(() => [ns.b(), ns.m(rateSize.value)])\n\n    const rateDisabled = computed(() => props.disabled || elForm.disabled)\n    const text = computed(() => {\n      let result = ''\n      if (props.showScore) {\n        result = props.scoreTemplate.replace(\n          /\\{\\s*value\\s*\\}/,\n          rateDisabled.value ? `${props.modelValue}` : `${currentValue.value}`\n        )\n      } else if (props.showText) {\n        result = props.texts[Math.ceil(currentValue.value) - 1]\n      }\n      return result\n    })\n    const valueDecimal = computed(\n      () => props.modelValue * 100 - Math.floor(props.modelValue) * 100\n    )\n    const colorMap = computed(() =>\n      isArray(props.colors)\n        ? {\n            [props.lowThreshold]: props.colors[0],\n            [props.highThreshold]: { value: props.colors[1], excluded: true },\n            [props.max]: props.colors[2],\n          }\n        : props.colors\n    )\n    const activeColor = computed(() =>\n      getValueFromMap(currentValue.value, colorMap.value)\n    )\n    const decimalStyle = computed(() => {\n      let width = ''\n      if (rateDisabled.value) {\n        width = `${valueDecimal.value}%`\n      } else if (props.allowHalf) {\n        width = '50%'\n      }\n      return {\n        color: activeColor.value,\n        width,\n      }\n    })\n    const componentMap = computed(() =>\n      isArray(props.icons)\n        ? {\n            [props.lowThreshold]: props.icons[0],\n            [props.highThreshold]: {\n              value: props.icons[1],\n              excluded: true,\n            },\n            [props.max]: props.icons[2],\n          }\n        : props.icons\n    )\n    const decimalIconComponent = computed(() =>\n      getValueFromMap(props.modelValue, componentMap.value)\n    )\n    const voidComponent = computed(() =>\n      rateDisabled.value ? props.disabledvoidIcon : props.voidIcon\n    )\n    const activeComponent = computed(() =>\n      getValueFromMap(currentValue.value, componentMap.value)\n    )\n    const iconComponents = computed(() => {\n      const result = Array(props.max)\n      const threshold = currentValue.value\n      result.fill(activeComponent.value, 0, threshold)\n      result.fill(voidComponent.value, threshold, props.max)\n      return result\n    })\n\n    function showDecimalIcon(item: number) {\n      const showWhenDisabled =\n        rateDisabled.value &&\n        valueDecimal.value > 0 &&\n        item - 1 < props.modelValue &&\n        item > props.modelValue\n      const showWhenAllowHalf =\n        props.allowHalf &&\n        pointerAtLeftHalf.value &&\n        item - 0.5 <= currentValue.value &&\n        item > currentValue.value\n      return showWhenDisabled || showWhenAllowHalf\n    }\n\n    function getIconStyle(item: number) {\n      const voidColor = rateDisabled.value\n        ? props.disabledVoidColor\n        : props.voidColor\n      return {\n        color: item <= currentValue.value ? activeColor.value : voidColor,\n      }\n    }\n\n    function selectValue(value: number) {\n      if (rateDisabled.value) {\n        return\n      }\n      if (props.allowHalf && pointerAtLeftHalf.value) {\n        emit(UPDATE_MODEL_EVENT, currentValue.value)\n        if (props.modelValue !== currentValue.value) {\n          emit('change', currentValue.value)\n        }\n      } else {\n        emit(UPDATE_MODEL_EVENT, value)\n        if (props.modelValue !== value) {\n          emit('change', value)\n        }\n      }\n    }\n\n    function handleKey(e: KeyboardEvent) {\n      if (rateDisabled.value) {\n        return\n      }\n      let _currentValue = currentValue.value\n      const code = e.code\n      if (code === EVENT_CODE.up || code === EVENT_CODE.right) {\n        if (props.allowHalf) {\n          _currentValue += 0.5\n        } else {\n          _currentValue += 1\n        }\n        e.stopPropagation()\n        e.preventDefault()\n      } else if (code === EVENT_CODE.left || code === EVENT_CODE.down) {\n        if (props.allowHalf) {\n          _currentValue -= 0.5\n        } else {\n          _currentValue -= 1\n        }\n        e.stopPropagation()\n        e.preventDefault()\n      }\n      _currentValue = _currentValue < 0 ? 0 : _currentValue\n      _currentValue = _currentValue > props.max ? props.max : _currentValue\n      emit(UPDATE_MODEL_EVENT, _currentValue)\n      emit('change', _currentValue)\n      return _currentValue\n    }\n\n    function setCurrentValue(value: number, event: MouseEvent) {\n      if (rateDisabled.value) {\n        return\n      }\n      if (props.allowHalf) {\n        // TODO: use cache via computed https://github.com/element-plus/element-plus/pull/5456#discussion_r786472092\n        let target = event.target as HTMLElement\n        if (hasClass(target, ns.e('item'))) {\n          target = target.querySelector(`.${ns.e('icon')}`)!\n        }\n        if (target.clientWidth === 0 || hasClass(target, ns.e('decimal'))) {\n          target = target.parentNode as HTMLElement\n        }\n        pointerAtLeftHalf.value = event.offsetX * 2 <= target.clientWidth\n        currentValue.value = pointerAtLeftHalf.value ? value - 0.5 : value\n      } else {\n        currentValue.value = value\n      }\n      hoverIndex.value = value\n    }\n\n    function resetCurrentValue() {\n      if (rateDisabled.value) {\n        return\n      }\n      if (props.allowHalf) {\n        pointerAtLeftHalf.value =\n          props.modelValue !== Math.floor(props.modelValue)\n      }\n      currentValue.value = props.modelValue\n      hoverIndex.value = -1\n    }\n\n    watch(\n      () => props.modelValue,\n      (val) => {\n        currentValue.value = val\n        pointerAtLeftHalf.value =\n          props.modelValue !== Math.floor(props.modelValue)\n      }\n    )\n\n    if (!props.modelValue) {\n      emit(UPDATE_MODEL_EVENT, 0)\n    }\n\n    return {\n      ns,\n      hoverIndex,\n      currentValue,\n      rateDisabled,\n      text,\n      decimalStyle,\n      decimalIconComponent,\n      iconComponents,\n      rateKls,\n\n      showDecimalIcon,\n      getIconStyle,\n      selectValue,\n      handleKey,\n      setCurrentValue,\n      resetCurrentValue,\n    }\n  },\n})\n</script>\n"]},"metadata":{},"sourceType":"module"}